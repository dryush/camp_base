# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/


filterTable = (table, camps) ->
  tableRowByCampIndex= []
  for i in [1...table.rows.length]
    tableRow = table.rows[i]
    #Запоминаем изначальное значение display
    if ! tableRow.deffaultDisplayMod?
      tableRow.deffaultDisplayMod = tableRow.style.display
    #Прячем строку
    tableRow.style.display = 'none'
    #Запоминаем строки по индексу
    tableRowByCampIndex[tableRow.cells[0].innerText] = tableRow

  for camp in camps
    #Показываем строки, соответствующие переданным  турбазам
    if tableRowByCampIndex[camp.id]?
      tableRowByCampIndex[camp.id].style.display = tableRowByCampIndex[camp.id].deffaultDisplayMod





$(document).on 'turbolinks:load', ->
  campsTable = $('.camps-table')[0]

  filterCampsTable = (camps) ->
    filterTable(campsTable, camps)

  locSelect = $('.location-select').find('select')
  locSelect.on 'change', (e) ->
    #Получаем значения выбранного в селекте пункта
    selectVal = e.currentTarget.options[e.currentTarget.selectedIndex].value
    #Cоставляем строку get-запроса
    dataStr = e.currentTarget.valName + '=' + selectVal

    $.ajax({
      type: "GET"
      url: "/camps/"
      data:  dataStr
      dataType: "Json"
      success: (data) -> filterCampsTable(data)
    })
